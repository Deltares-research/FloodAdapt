---
title:	Database Builder
filters:
  - lightbox
lightbox: auto
---
 The FloodAdapt database builder is intended to greatly simplify the process of setting up FloodAdapt in a new location. The FloodAdapt software is an 'empty shell' that must be connected to a site-specific database. The database builder aids the user in setting up this database. 
 
 The most critical components of the FloodAdapt database are the SFINCS and Delft-FIAT models, both of which can now be generated with greater ease using the [SFINCS model-builder](SFINCS/index.qmd) and the [Delft-FIAT model-builder](Delft_Fiat/index.qmd). Once these have been created, users can run the FloodAdapt database builder to generate a complete database for a functioning FloodAdapt application at their site. 

 Running the database builder consists of double-clicking the FloodAdapt database-builder executable. This opens a screen where the user can enter a file path to the database-builder configuration file. 

 This documentation will describe the FloodAdapt database-builder configuration file. Depending on the amount of information included in the configuration file, different FloodAdapt functionalities will be activated. This is described in the section [FloodAdapt capabilities based on configuration](#floodadapt-capabilities-based-on-configuration). It starts by outlining the minimum information required to generate a functional FloodAdapt system, and then specifies additional functionalities and the required information in the configuration file to activate them. The section [Configuration file attributes](#configuration-file-attributes) specifies all of the attributes that can be included in the database-builder configuration and includes details about their format and use. 


## FloodAdapt capabilities based on configuration
There are different functionalities that are activiated in FloodAdapt depending on the information contained in the configuration file. This section starts by describing the information needed for the [baseline FloodAdapt configuration](#baseline-floodadapt-configuration), which is the minimum needed to set up a functional FloodAdapt system. Note that an important requirement is that a Delft-FIAT model and an overland SFINCS model have been set up for the site. The following sections then describe additional FloodAdapt functionality that is activated with additional configuration input. 

### Baseline FloodAdapt configuration
A baseline FloodAdapt configuration is a functional version of FloodAdapt that requires the minimum amount of configuration input. This version allows users to run event scenarios for either a synthetic event or a historical gauged event. All measures and future projections are available for analysis. Note that because it only supports event scenarios, the risk and benefits options are not available for this baseline configuration.

The following are required to set up a baseline FloodAdapt configuration:

* A name for your site
* The path to your overland SFINCS model folder
* The path to your Delft-FIAT model folder
* The unit system you want to work in (imperial or metric)
* Max values for mapping bins

A screenshot of an example configuration file for a baseline FloodAdapt model for Chesapeake Beach is shown in @fig-DB_baseline

![**Example configuration file for a baseline FloodAdapt model for Chesapeake Beach**](../_static/images/database_baselineConfig.png){width=100% fig-align=left #fig-DB_baseline}

### Risk and benefit analysis
To activate the functionality to calculate risk and benefits in FloodAdapt, the user must have a [probabilistic event set](risk_analysis.qmd) prepared. They can then specify the location of the probabilistic event set in the configuration file

![**Snippet of configuration file showing the addition of a probabilistic event set to activate the risk and benefit analysis functionalities**](../_static/images/database_probEventSet.png){width=100% fig-align=left #fig-DB_probEventSet}

### Simulating hurricane events and 'ungauged' historic events
To add the ability to simulate a scenario with a historical hurricane, the user needs an offshore SFINCS model, which can also be created with the [SFINCS model-builder](SFINCS/index.qmd). Many offshore SFINCS models have been created for the U.S. East and Gulf coasts and may be available for use at no cost. In addition to specifying an offshore model, the user can also indicate which 'cyclone basin' is relevant for them. @fig-DB_cyclonesNA shows the hurricane selection window for the example of choosing "North America" as the cyclone basin. 

![**Snippet of configuration file showing the offshore model and a selection of a 'cyclone basin'**](../_static/images/database_offshore_snippet.png){width=100% fig-align=left #fig-DB_offshore_snippet}

![**Adding an offshore model activates the ability to select a hurricane event, as well as an 'ungauged' historical event. Both of these event types make use of the offshore model. The left window shows the "Add event" popup window for the baseline FloodAdapt configuration, and the right shows with the addition of an offshore model**](../_static/images/database_offshore.png){width=70% fig-align=left #fig-DB_offshore}

![**Hurricane selection window when a user has selected "NA" for North America as the 'cyclone basin'**](../_static/images/database_cyclones_NA.png){width=70% fig-align=left #fig-DB_cyclonesNA}


### Downloading historical water levels
To activate the ability to easily download water levels when specifying a historical event, users in the U.S. can add a tide gauge configuration attribute and set it to obtain the water levels automatically from the [NOAA COOPS](https://tidesandcurrents.noaa.gov/stations.html) website. 

![**Snippet of configuration file showing the addition of a tide gauge**](../_static/images/database_tideGauge.png){width=100% fig-align=left #fig-DB_tideGauge}


![**Adding a tide gauge allows a user to activate the 'Download observed water levels' button. Additionally, it also allows users to specify different references they can view with the water level time series, and to set a different reference level ('zero') than MSL. The left window shows the baseline FloodAdapt configuration, and the right shows with the addition of a tide gauge.**](../_static/images/database_comp_tideGauge.png){width=70% fig-align=left #fig-DB_comp_tideGauge}

### Social vulnerability insights
To activate functionalities in FloodAdapt which provide social vulnerability insights, users can specify in the database configuration file a social vulnerability index layer, and a threshold above which residents are considered highly socially vulnerable. @fig-DB_SVI

![**Snippet of configuration file showing the addition of an SVI layer**](../_static/images/database_SVI.png){width=100% fig-align=left #fig-DB_SVI}

When an SVI layer is included, and a threshold defining highly socially vulnerable people is given (see @fig-DB_SVI), FloodAdapt shows additional information in the infographic, the metrics table, and allows the user to view the SVI layer in both the [Measures](../4_user_guide/measures/index.qmd) and [Output](../4_user_guide/output/index.qmd) tabs.  @fig-DB_SVI_comp highlights the added information in the infographic and metrics table. It shows the baseline configuration on the left, and the configuration with an SVI layer added on the right. With the SVI layer included, users can see in the infographic the proprotion of highly-vulnerable residential buildings that were damaged and destroyed. In the metrics table, they can see how many highly vulnerable residential properties were flooded. 

![**When an SVI layer and a threshold are included, the infographic will include an additional graphic showing the distribution of residential impacts on high and low socially vulnerable homes **](../_static/images/database_SVI_comp.png){width=100% fig-align=left #fig-DB_SVI_comp}

### Visualizing water level output time series
FloodAdapt allows users to view modeled water level time series at observation points in the FloodAdapt [Output tab](../4_user_guide/output/index.qmd). To activate this functionality, observation points can be added to the database-builder configuration file. 

![**Snippet of configuration file showing the addition of observation points**](../_static/images/database_obs_snippet.png){width=100% fig-align=left #fig-DB_SVI_comp}

![**Adding observation points activates the functionality to view water level time series output at these points in the FloodAdapt [Output tab](../4_user_guide/output/index.qmd). The left window shows the baseline FloodAdapt configuration, and the right shows with the addition of observation points.**](../_static/images/database_obsComp.png){width=100% fig-align=left #fig-DB_obscomp}


### Elevating buildings above base flood elevation (BFE)
FloodAdapt allows users to explore home elevations as an adaptation measure. With the base configuration, FloodAdapt users can specify how high a home should be elevated relative to a datum. However, in the U.S. standards for home elevations or elevations of new buildings are often specified relative to *base flood elevation* (BFE). This is a regulatory 100-year flood level calculated by the federal government. When users reference a base flood elevation layer in the configuration file, FloodAdapt users can choose to elevate homes above a datum or to a height above BFE.

![**Snippet of configuration file showing the addition of a base flood elevation layer**](../_static/images/database_bfe_snippet.png){width=100% fig-align=left #fig-DB_SVI_comp}

![**Adding a base flood elevation (BFE) layer activates the ability to elevate homes relative to BFE in addition to elevating relative to datum**](../_static/images/database_bfe_comp.png){width=100% fig-align=left #fig-DB_obscomp}

### Sea level rise scenario selection
FloodAdapt allows users to explore the flooding and impacts for future sea level rise projections. In the base configuration case, users have access to this functionality, and can enter a sea level rise explicitly, for example "0.5 feet". However, FloodAdapt users may want to explore flooding and impacts at a specific point in the future, for example in 15 or 20 years, and they may not know the sea level rise to expect in that future year. To facilitate these users, a sea level rise scenario CSV file can be included in the database setup. There are many sources for sea level rise scenarios, such as the [interagency sea level task force](https://sealevel.globalchange.gov/resources/2022-sea-level-rise-technical-report/). The CSV file contains future years in the first column and sea level rise projections for different SLR scenarios in the remaining colunns. There is no limit to the number of SLR scenarios a user can include. FloodAdapt uses this file to generate a visualization showing the different SLR scenario curves in the [Projections](../4_user_guide/projections/index.qmd) selection window. It also allows a user to enter a future year and select a SLR scenario, and then automatically calculates the sea level rise for that year. 

![**Snippet of configuration file showing the addition of a sea level rise scenario CSV file**](../_static/images/database_SLR_snippet.png){width=100% fig-align=left #fig-DB_SVI_comp}

![**Including a sea level rise scenario CSV file allows a user to select one of the SLR scenarios and a future year, and FloodAdapt automatically calculates the sea level rise**](../_static/images/database_SLR_comp.png){width=100% fig-align=left #fig-DB_slrComp}

::: {.callout-note}
## What about when sea level rise scenarios change?
Sea level rise scenarios are updating every few years. Updating the sea level rise scenarios in FloodAdapt is a simple as updating the CSV file with the years and projected sea level rise. FloodAdapt will then automatically use the new information when a FloodAdapt user selects a future year and a sea level rise scenario. 
:::

## Configuration file attributes

### Header attributes
![**Snippet showing the attributes of the top of the configuration file**](../_static/images/database_attr_baseline.png){width=100% fig-align=left #fig-DB_header}

@fig-DB_header shows the attributes that are given at the top of the configuration file. These will be described below. 

**Mandatory** attributes are:

* **name** - this is the name of the database folder for your site
* **database_path** - this is the path where your database folder will be saved
* **sfincs** - this is the location of your SFINCS overland model
* **fiat** - this is the locaiton of your Delft-FIAT model
* **unit system** - this is either "<span style="color:orange">imperial</span>" or "<span style="color:orange">metric</span>"

**Optional** attributes are:

* **sfincs_offshore** - this is the location of your SFINCS offshore model
* **cyclone_basin** - this is the region where your site is located, for filtering the tropical cyclones (hurricanes) that show up in the hurricane selection window. Options are **TO BE FILLED IN**
* **probabilistic_set** - this is the path to the prepared event set and event frequencies which enable risk analysis

### GUI attributes
![**Snippet showing the attributes of the GUI**](../_static/images/database_GUI_snippet.png){width=100% fig-align=left #fig-DB_GUI}

@fig-DB_GUI shows the attributes that are required for the GUI. These are **mandatory** attributes that must be included in the base configuration file. 

The GUI attributes all have to do with maximum values. These are used to create automatic bins for the spatial mapping of flooding, impacts, and benefits. The values that need to be specified are:

* **max_flood_depth** - this will be the highest legend value in the output flood maps (above which all values get the same color).  
* **max_aggr_dmg** - this will be the highest legend value in the output aggregated damages maps (above which all values get the same color). A good choice for this value will depend on the size of your aggregation, the density of the building footprints, and the currency value in the application area. It can be difficult to know apriori what to pick here, but the value can always be changed later in the FloodAdapt database static/site.toml file under the [gui.mapbox_layers] section. 
* **max_footprint_dmg** - this will be the highest legend value in the output building damages maps (above which all values get the same color), and can be estimated based on the maximum potential values of the buildings in the site area. 
* **max_benefits** - this is the maximum value for the spatial benefits. This can also be difficult to estimate apriori, but can be changed later in the FloodAdapt database static/site.toml file under the [gui.mapbox_layers] section.

### Building footprints
The attributes for building footprints are shown in @fig-DB_BFs. A building footprint layer allows users to visualize the building footprint damages in the output maps (instead of only points). 

![**Snippet showing the attributes of the baseline configuration**](../_static/images/database_attr_BFs.png){width=100% fig-align=left #fig-DB_BFs}

For building footprints you must provide:

* **file** - this is the path to the building footprint file (this should be a vector file, like a shapefile or a geopackage), making sure to use forward slahses in the paths. 
* **field_name** - this should be a unique identifier attribute in the vector file, like an Object ID. 

### Tide Gauge
The attributes needed to include a tide gauge are shown in @DB_tideGauge. The inclusion of a tide gauge allows FloodAdapt users to automatically download water levels for a specified start and end time. 

![**Snippet showing the attributes of the tide gauge configuration**](../_static/images/database_tideGauge_extended.png){width=100% fig-align=left #fig-DB_tideGauge}

For a tide gauge you must provide:

* **source** - this is either "<span style="color:orange">noaa_coops</span>" if you want to use the closest NOAA gauge station from https://tidesandcurrents.noaa.gov/stations.html (only available in the U.S.) OR "<span style="color:orange">file</span>" if you will be providing gauge data (water level time series) in a CSV file. 
* **file** - this is only required if the source is equal to "<span style="color:orange">file</span>". It should be the path to a CSV file containing the gauged water level time series. The CSV file should have two columns; the first contains a 'datetime' in the format DD/MM/YYYY HH:MM and the second column contains the water levels relative to mean sea level. 
* **ref** - this is an optional attribute; if provided, it will be used as the 'zero' when plotting event water levels in the event specification window of FloodAdapt.  
* **[tide_gauge.max_distance]** - this is a section to specify the maximum radius around the site to search for a tidal gauge station. This prevents tide gauges being applied to a site that are too far away to be representative. The attributes that fall under this are **value** which gives a numeric value for the distance, and **units** which specifies the unit of the value (e.g. "miles"). See @fig-DB_tideGauge for an example. 

### Social vulnerability index (SVI)
The attributes needed to include an SVI layer are shown in @fig-DB_SVI. The inclusion of an SVI layer allows FloodAdapt users to get additional information in the infographic related to who is being impacted, and to view the layer in the FloodAdapt Measures and Output tabs.  

![**Snippet showing the attributes of the SVI layer configuration**](../_static/images/database_SVI.png){width=100% fig-align=left #fig-DB_SVI}

For an SVI layer you must provide:

* **file** - this is the path to the geospatial file with the SVI layer 
* **field_name** - this is the name of the attribute in the geospatial file that contains the social vulnerability index.  
* **threshold** - this is the value of the SVI above which homes will be considered to have a high social vulnerability.