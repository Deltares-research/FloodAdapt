---
title:	Delft-FIAT model-builder
filters:
  - lightbox
lightbox: auto
execute:
  echo: false
jupyter: python3
---

he Delft-FIAT model-builder allows users to rapidly set up a Delft-FIAT model using a 'quick-build' option (and link to that section here) using default modeling choices, or to build a tailored Delft-FIAT model (link to that section here), making the Delft-FIAT model creation accessible for any type of user (incl. users without modeling experience). 

# Getting started and selecting your model boundary

These are steps that are carried out whether you do quickbuild (@sec-quickbuild) or tailored model-building (@sec-tailored_model). 

*Step-by-step instructions to get started*  

  1. Go to **File** >> **Select Working Directory**.
  2. Select an output folder.
  3. Generate model boundaries

To select a model boundary, you have four options:

  1. Go to the **Model Boundary | Quickbuild** -tab and select any of the options in the drop-down menu to create the boundary (@fig-boundaries).
      a) **Draw polygon**: Click on the map and draw a valid polygon. Double click will end the drawing process.
      b) **Draw box**: Click on the map and draw a box. Double click will end the drawing process.
      c) **SFINCS model domain**: If you aleady created a SFINCS model you can select the **/gis-folder**. Do <u>not</u> select the region file itself. It will be recognized automatically by the model.
      d) **Upload file**: You can upload your own boundary in form of a vector file (e.g. *.gpkg*, *.geojson*) with a valid polygon shape. 

  2. When you are finished, click **"Generate Boundary"**.

![Workflow to create model boundaries.](../../_static/figures/Draw_boundaries.svg){#fig-boundaries}

For further details please refer to @fig-model_boundaries.

::: {#fig-model_boundaries}

{{< video ../../_static/videos/hydromt_fiat/Generate_Boundaries.mp4 >}}

Create model boundaries using the "Draw Polygon" method.

:::

## Quickbuild {#sec-quickbuild}
If you set up a model in the United States and do not want to use your own data you can simply choose to work with the **quickbuild**. 

The **quickbuild** downloads the data from different sources:  

* **Exposure**: National Structure Inventory (NSI)
* **Vulnerability curves**: FEMA HAZUS database
* **Socio-economic/equity data**: US census data
* **Roads**: Open Street Map (OSM)

*Step-by-step instructions for the Quick Build*

  1. Go to the **Model Boundary | Quickbuild** -tab and select any of the options in the drop-down menu to create the boundary (@fig-quickbuild).
  2. After you generated the model boundaries you can select the quickbuild option.

![Workflow to use the "Quickbuild"-option.](../../_static/figures/Quickbuild.svg){#fig-quickbuild}

For further details please refer to @fig-nsi_quickbuild.

::: {#fig-nsi_quickbuild}

{{< video ../../_static/videos/hydromt_fiat/Quickbuild.mp4 >}}

Quickbuild option in the United States using NSI exposure, FEMA Hazus Damage Curves and OSM roads.

:::

## Tailored Delft-FIAT model {#sec-tailored_model}
This section explains the creation of a simple Delft-FIAT model configured by the user. The model can be set up at any location worldwide.

### Create the exposure data
There are two different database sources to download the **exposure data** from, determined by the location of your model:

1. **United States: National Structure Inventory (NSI)**
2. **Global: Open Street Map (OSM)**

Additionally, you can download **road data** from Open Street Map. 

*Step-by-step instructions to setup the exposure data*  

To set up the exposure data open the **"Exposure"**-tab on the top panel (@fig-exposure). 
  1. Generate your model boundaries
  2. Select the **"Asset Location"**-tab at the bottom panel.
  3. For a U.S. based model start with **NSI** data and for a global model start with **OSM** data.
  4. ***Only OSM***: Define a <u>damage currency (JRC damage curves default is Euro)</u> and the <u>finished floor height (meters)</u> for all assets (can be updated later on the individual asset level in the Exposure >> Finished Floor Height-tab) .
  5. ***optional***: Include OSM roads by checking the checkbox "Include OSM roads".
  6. Add to model.
  
 #######After creating your model you should end up with a folder structure as describted in the section [Data Input - Folder Structure] Add this somewhere here
![Workflow to setup exposure data with NSI (National Structure Inventory) or OSM (Open Street Map) as data source.](../../_static/figures/Exposure.svg){#fig-exposure}

These are all the necessary steps to set up the exposure for a **simple model**. If you want to update the model or input your own data, please refer to the section *Model from scratch: Advanced model* (in progress). 

The videos below demonstrate the exposure setup using the NSI data for exposure and OSM data for roads (@fig-nsi_exposure) as well as the exposure setup for a global model, using OSM data (incl. roads; @fig-osm_exposure).

::: {#fig-nsi_exposure}

{{< video ../../_static/videos/hydromt_fiat/Exposure_NSI.mp4 >}}

Exposure setup in the United States using NSI exposure and OSM roads.

:::


::: {#fig-osm_exposure}

{{< video ../../_static/videos/hydromt_fiat/Exposure_OSM.mp4 >}}

Global exposure setup using OSM exposure and OSM roads .

:::

#### Update Finished Floor Height
To set up the finished floor height open the **"Exposure"**-tab on the top panel and select the **"Finished Floor Height"**-tab in the bottom panel. 

*Step-by-step instructions to setup/update the Finished Floor Height*  

  1. Select the file source of your finished floor height data. The file must be a point- or polygon vector file (e.g. *.gpkg*, *.geojson*).
  2. Load the file. This will load the data columns in your file into the **Attribute ID** drop-down menu.
  3. Select the column that holds the finished floor height data. 
  4. *optional Settings*: Define the method for the spatial joint of your exposure assets with the new finished floor height. The default for point data is *'nearest'* and for polygon data *'intersection'*. The default will be automatically selected by the model builder. If you do not wish to change the default settings there is no need to change the settings. 
  5. Click **Add to model**.

::: {#fig-ffh}

{{< video ../../_static/videos/hydromt_fiat/Finished_floor_height.mp4 >}}

Model refinement with user input for finished floor height. 

:::


#### Update Ground Elevation
To set up the ground elevation open the **"Exposure"**-tab on the top panel and select the **"Ground Elevation"**-tab in the bottom panel.

*Step-by-step instructions to setup/update the Ground Elevation*  
There are two options in the drop-down menu to set up the ground elevation data:
  1. SFINCS Ground Elevation

    a. If you have already a SFINCS model you can use the same ground elevation from your SFINCS model. Open the  subgrid-folder of the SFINCS model, in which the dep_subgrid.tif-file is located. Do not select the file, simply the folder, the model builder will recognize the file automatically.
    b. Click **Add to model**.

  2. Upload file

    a. Select the file source of your ground elevation data. The file must be a raster file (e.g. *.tif*).
    b. Select the elevation unit of your file (meters or feet).
    d. Click **Add to model**. 

::: {#fig-ground_elevation}

{{< video ../../_static/videos/hydromt_fiat/Ground_elevation.mp4 >}}

Model refinement with user input for ground elevation. 

:::

#### Update Max. Potential Damages
To set up the max. potential damages open the **"Exposure"**-tab on the top panel and select the **"Max. Potential Damages"**-tab in the bottom panel.  
It is possible to update the *structural* damages and the *content* damage. You can update them one at a time with the following steps. 

*Step-by-step instructions to setup/update the Max. Potential Damages*  

  1. Select the file source of your max. potential damage data. The file must be a point- or polygon vector file (e.g. *.gpkg*, *.geojson*).
  2. Load the file. This will load the data columns in your file into the **Attribute ID** drop-down menu.
  3. Select the column that holds the max. potential damage data (either "strucutral"or "content").
  4. Select the Damage Type either *structural* or *content*, depending on your data.  
  4. *optional Settings*: Define the method for the spatial joint of your exposure assets with the new finished floor height. The default for point data is *'nearest'* and for polygon data *'intersection'*. The default will be automatically selected by the model builder. If you do not wish to change the default settings there is no need to change the settings. 
  5. Click **Add to model**.

  ::: {#fig-max_pot_damages}

{{< video ../../_static/videos/hydromt_fiat/Max_potential_damages.mp4 >}}

Model refinement with user input for maximum potential damages. 

:::

### Assign vulnerability curves
As a next step you must assign the vulnerability curves to the exposure data. There are two data sources which the vulnerability curves are downloaded from, determined by the location of your model:

1. **United States: FEMA Hazus Curves**
2. **Global: JRC Vulnerability Curves**

*Delft-FIAT model-builder instructions*  
To set up the vulnerability curves open the **"Vulnerability"**-tab on the top panel (@fig-vulnerability_curve). 

  1. The Delft-FIAT model-builder will automatically select the correct <u>default curves</u> for your model based upon your exposure data (NSI or global). Therefore, you only need to add the curves to the model without further adjustment. For detailed information about the default curves please refer to the [JRC Global flood depth-damage functions](https://publications.jrc.ec.europa.eu/repository/handle/JRC105688) for a global model. For a model in the United States, consult this publication by Rice University describing [FEMA HAZUS curves](https://www.cs.rice.edu/~devika/evac/papers/Hazus_floodII.pdf) in the section on depth-damage functions. 

  2. ***Only NSI***: If desired, you can specify different curves from the default  by selecting "Specify different damage curves". First, select the asset you want to assign another damage curve to and second, select a new damage curve (@fig-update_curves). 

![Workflow to assign vulnerability curves to assets with option to update default NSI vulnerability curves.](../../_static/figures/vulnerability.svg){#fig-vulnerability_curve}

You can follow the steps in the video below (@fig-vulnerability).

::: {#fig-vulnerability}

{{< video ../../_static/videos/hydromt_fiat/NSI_Vulnerability.mp4 >}}

Assign the default vulnerability curves to the exposure data. 

:::

::: {#fig-update_curves}

{{< video ../../_static/videos/hydromt_fiat/Update_default_damage_curve.mp4 >}}

***Only NSI***: Update default vulnerability curves. 

:::

### Additional features
#### Social Vulnerability Index (SVI) and Equity
Delft-FIAT allows you to evaluate the equitible distribution of damages and benefits by using the **social vulnerability index** and **equity**. If your model site is located in the United States, SVI data can be calculated based upon recent literature. 
However, the user has the freedom to upload any social vulnerability index and/or equity layer in form of a **vector file** (e.g. *.gpkg*, *.geojson*) and assign a value to each asset that overlaps the layer at any location (@fig-additional_attr).

*Delft-FIAT model-builder instructions*  
Follow these instructions when setting up a model in the **United States** (@fig-svi)

  1. In the top panel, select *"SVI + Equity"*.
  2. In the bottom panel, select the year you wish to download data frame.
  3. Check the checkboxes to download, SVI and/or Equity data.

If your model is setup in a location outside the U.S please refer to the section *Additional attributes* for instructions. 

![Adding SVI/Equity and additional attributes (e.g. landuse) to the model](../../_static/figures/svi_workflow.svg){#fig-svi}

For a detailed demonstration please refer to @fig-svi_equity.

::: {#fig-svi_equity}

{{< video ../../_static/videos/hydromt_fiat/SVI_and_Equity_detail.mp4 >}}

Add additional attributes to your model. In this example, a land use layer is added to the model, and assets are assigned to the land use category that encompasses each asset. 

:::

#### Additional attribtues
Not only social vulnerability and/or equity can be linked to the exposure data. Any additional layer (e.g. landuse, administrative boundaries or others) can be addedd (@fig-svi). The additional attribute layer must be a **vector file** (e.g. *.gpkg*, *.geojson*) in the same location of your model. 

*Delft-FIAT model-builder instructions*  
If you wish to add **SVI** and/or **Equity** follow these intstructions. The same instructions apply for any aggregation layer or additional attribute you wish to add on your model. 

  1. In the top panel, select *"Additional Attributes"*.
  2. In the bottom panel *"Add new Source"*, select the **source** of your vector layer and **load** it into the model. 
  3. In the bottom panel *"Select attribute"*, select the **Attribute ID** from the dropdown menu. If you loaded in your file corretly the drop-down menu includes all columns of your data file. Select the column of the attribute/aggregation you wish to add on your model. 
  4. In the bottom panel *"Select attribute"*, give your layer a **Label** (free-text). This label will be the header for your new additional attribute/aggregation layer in the output data. 
  5. In the bottom panel *"Select attribute"*, click **Add** to add the new layer and the layer will appear in the table in the bottom panel *"Overview attribute"*. 
  6. In the bottom panel *"Overview attribute"*, you can check the checkbox **"Display Attribute"** to verify the correct output of the vector layer. 
  7. You can repeat this process for as many layers as you wish.
  8. As soon you added all the layers you wish to add, select **Add to model** and your new additional attributes/aggregation layer is added to your final model. 
 
For a detailed demonstration please refer to @fig-additional_attr.

::: {#fig-additional_attr}

{{< video ../../_static/videos/hydromt_fiat/Additional_Attributes_NSI.mp4 >}}

Add additional attributes to your model. In this example, a land use layer is added to the model, and assets are assigned to the land use category that encompasses each asset. 

:::


### Create model and visualize the output

::: {#fig-create_model}

{{< video ../../_static/videos/hydromt_fiat/create_model_and_output.mp4 >}}

Finalization of the model and visualization of the output.  

:::


At this point you are ready to create the Delft-FIAT model. Verify that data sources in the bottom tab match your model input. If so, create your model (@fig-create_model).

::: {#fig-create_model}

{{< video ../../_static/videos/hydromt_fiat/Create_model_OSM.mp4 >}}

Create your Delft-FIAT model. 

:::